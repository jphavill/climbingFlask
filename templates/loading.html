{% extends "base.html" %}

{% block content %}

<h2 class="title">
    Please wait while your recent climbing data is retrieved.
</h2>
<h3 class="subtitle">
  This page will automatically redirect when the data is loaded.
</h3>
<div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
    <span class="sr-only">Loading...</span>
</div>
<script>
    const data = {
        email: '{{form_data["email"]}}',
        password: '{{form_data["password"]}}',
        phone: '{{form_data["phone"]}}',
    }

    function navigate() {
        window.location.href = 'climb';  // Redirects user to the /map route when 'create_map' is finished
    }
    fetch('first_time_setup', {
        method: 'POST',
        headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    }).then(navigate); // Performing 'create_map' and then calls navigate() function, declared above
</script>
{% endblock %}